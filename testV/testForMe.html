<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prüfungs-Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .timer {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        
        .question-card {
            border-left: 4px solid #4F46E5;
            transition: all 0.3s ease;
        }
        
        .question-card:hover {
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background-color: #4F46E5;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: #4338CA;
            transform: translateY(-1px);
        }
        
        .btn-primary:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
            transform: none;
        }
        
        .answer-option {
            cursor: pointer;
            border: 2px solid #E5E7EB;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        
        .answer-option:hover {
            border-color: #4F46E5;
            background-color: rgba(79, 70, 229, 0.05);
        }
        
        .answer-option.selected {
            border-color: #4F46E5;
            background-color: rgba(79, 70, 229, 0.1);
        }
        
        .answer-option.correct {
            border-color: #10B981;
            background-color: rgba(16, 185, 129, 0.1);
        }
        
        .answer-option.incorrect {
            border-color: #EF4444;
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        .difficulty-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .difficulty-easy {
            background-color: #D1FAE5;
            color: #065F46;
        }
        
        .difficulty-medium {
            background-color: #FEF3C7;
            color: #92400E;
        }
        
        .difficulty-hard {
            background-color: #FEE2E2;
            color: #B91C1C;
        }
        
        .progress-bar {
            height: 0.5rem;
            background-color: #E5E7EB;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background-color: #4F46E5;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4F46E5;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
            <h1 class="text-2xl font-bold text-gray-900">Prüfungs-Manager</h1>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Home Page -->
        <div id="home-page" class="fade-in">
            <div class="bg-white shadow rounded-lg p-6 md:p-8">
                <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-4">Willkommen zum Prüfungs-Manager!</h2>
                <div class="prose max-w-none">
                    <p class="text-gray-600 mb-6">
                        Mit dieser Anwendung kannst du individuelle Prüfungen erstellen und durchführen. 
                        Wähle deine Themen, den Schwierigkeitsgrad und die Anzahl der Fragen, 
                        und schon kann es losgehen! Alle Fragen werden aus der Open Trivia Database geladen.
                    </p>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">So funktioniert's:</h3>
                    <ol class="list-decimal pl-5 space-y-2 text-gray-600 mb-6">
                        <li>Klicke auf "Neue Prüfung starten" und wähle deine Einstellungen.</li>
                        <li>Beantworte die Fragen innerhalb der vorgegebenen Zeit.</li>
                        <li>Erhalte sofort deine Auswertung und lerne aus deinen Ergebnissen.</li>
                    </ol>
                </div>
                <div class="mt-8 flex justify-center">
                    <button id="start-btn" class="btn-primary">Neue Prüfung starten</button>
                </div>
            </div>
            
            <!-- Features Section -->
            <div class="mt-10 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-100 rounded-md p-3">
                                <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                </svg>
                            </div>
                            <div class="ml-5">
                                <h3 class="text-lg font-medium text-gray-900">Vielfältige Kategorien</h3>
                                <p class="mt-2 text-sm text-gray-500">Wähle aus zahlreichen Themengebieten für deine Prüfung.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-100 rounded-md p-3">
                                <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                                </svg>
                            </div>
                            <div class="ml-5">
                                <h3 class="text-lg font-medium text-gray-900">Anpassbare Schwierigkeit</h3>
                                <p class="mt-2 text-sm text-gray-500">Stelle den Schwierigkeitsgrad ganz nach deinem Wissen ein.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-indigo-100 rounded-md p-3">
                                <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                            </div>
                            <div class="ml-5">
                                <h3 class="text-lg font-medium text-gray-900">Detaillierte Auswertung</h3>
                                <p class="mt-2 text-sm text-gray-500">Erhalte sofort Feedback zu deinen Antworten und deiner Gesamtleistung.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="settings-page" class="hidden fade-in">
            <div class="bg-white shadow rounded-lg p-6 md:p-8">
                <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-6">Prüfungseinstellungen</h2>
                <form id="settings-form" class="space-y-6">
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700">Kategorie</label>
                        <select id="category" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="">Alle Kategorien</option>
                            <!-- Kategorien werden dynamisch geladen -->
                        </select>
                    </div>
                    
                    <div>
                        <label for="difficulty" class="block text-sm font-medium text-gray-700">Schwierigkeitsgrad</label>
                        <select id="difficulty" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="">Beliebig</option>
                            <option value="easy">Leicht</option>
                            <option value="medium">Mittel</option>
                            <option value="hard">Schwer</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700">Anzahl der Fragen</label>
                        <input type="number" id="amount" min="1" max="50" value="10" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    </div>
                    
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700">Zeit pro Frage (in Sekunden)</label>
                        <input type="number" id="time" min="10" max="300" value="30" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    </div>
                    
                    <div class="flex justify-between">
                        <button type="button" id="back-to-home" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Zurück
                        </button>
                        <button type="submit" id="start-exam-btn" class="btn-primary">
                            Prüfung starten
                        </button>
                    </div>
                </form>
                <div id="loading" class="hidden mt-4 flex justify-center items-center">
                    <div class="loading-spinner mr-3"></div>
                    <p>Lade Fragen...</p>
                </div>
                <div id="error-message" class="hidden mt-4 text-red-600"></div>
            </div>
        </div>
        
        <!-- Exam Page -->
        <div id="exam-page" class="hidden fade-in">
            <div class="timer shadow-lg fade-in">
                <div class="text-sm font-medium text-gray-500">Verbleibende Zeit</div>
                <div id="time-display" class="text-xl font-bold text-indigo-600">00:00</div>
            </div>
            
            <div class="bg-white shadow rounded-lg p-6 md:p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900">Prüfung läuft</h2>
                    <div>
                        <span id="current-question">1</span> / <span id="total-questions">10</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="progress-bar">
                        <div id="progress-bar-fill" class="progress-bar-fill" style="width: 10%"></div>
                    </div>
                </div>
                
                <div id="question-container" class="question-card p-5 border bg-gray-50 rounded-lg mb-6">
                    <div class="mb-2 flex justify-between items-center">
                        <div class="difficulty-badge difficulty-medium" id="question-difficulty">Mittel</div>
                        <div class="text-sm text-gray-500" id="question-category">Kategorie</div>
                    </div>
                    <h3 id="question-text" class="text-lg font-medium text-gray-900 mb-4">Frage wird geladen...</h3>
                    <div id="answers-container" class="space-y-3">
                        <!-- Antwortoptionen werden hier eingefügt -->
                    </div>
                </div>
                
                <div class="flex justify-between">
                    <button id="prev-question" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" disabled>
                        Vorherige Frage
                    </button>
                    <button id="next-question" class="btn-primary">
                        Nächste Frage
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Results Page -->
        <div id="results-page" class="hidden fade-in">
            <div class="bg-white shadow rounded-lg p-6 md:p-8">
                <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-4">Prüfungsergebnisse</h2>
                
                <div class="mb-8 p-6 bg-indigo-50 rounded-lg border border-indigo-100">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div>
                            <p class="text-sm font-medium text-gray-500">Gesamtpunktzahl</p>
                            <p id="total-score" class="text-3xl font-bold text-indigo-600">0/10</p>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Prozentsatz</p>
                            <p id="score-percentage" class="text-3xl font-bold text-indigo-600">0%</p>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Benötigte Zeit</p>
                            <p id="total-time" class="text-3xl font-bold text-indigo-600">00:00</p>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-lg font-medium text-gray-900 mb-4">Detaillierte Auswertung</h3>
                <div id="questions-review" class="space-y-6">
                    <!-- Fragen und Antworten werden hier eingefügt -->
                </div>
                
                <div class="mt-8 flex justify-center space-x-4">
                    <button id="new-exam" class="btn-primary">
                        Neue Prüfung starten
                    </button>
                    <button id="return-home" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Zurück zur Startseite
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-center text-sm text-gray-500">
                Prüfungs-Manager | Erstellt mit HTML, CSS und JavaScript | Verwendet Open Trivia Database API
            </p>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const homePage = document.getElementById('home-page');
            const settingsPage = document.getElementById('settings-page');
            const examPage = document.getElementById('exam-page');
            const resultsPage = document.getElementById('results-page');
            
            const startBtn = document.getElementById('start-btn');
            const backToHomeBtn = document.getElementById('back-to-home');
            const settingsForm = document.getElementById('settings-form');
            const categorySelect = document.getElementById('category');
            const loadingIndicator = document.getElementById('loading');
            const errorMessage = document.getElementById('error-message');
            
            const prevQuestionBtn = document.getElementById('prev-question');
            const nextQuestionBtn = document.getElementById('next-question');
            const currentQuestionSpan = document.getElementById('current-question');
            const totalQuestionsSpan = document.getElementById('total-questions');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const timeDisplay = document.getElementById('time-display');
            
            const newExamBtn = document.getElementById('new-exam');
            const returnHomeBtn = document.getElementById('return-home');
            
            // App State
            let questions = [];
            let currentQuestionIndex = 0;
            let userAnswers = [];
            let timer;
            let timeLeft;
            let totalTimeUsed = 0;
            let timePerQuestion;
            
            // Load categories when the application starts
            loadCategories();
            
            // Event Listeners
            startBtn.addEventListener('click', showSettingsPage);
            backToHomeBtn.addEventListener('click', showHomePage);
            settingsForm.addEventListener('submit', handleSettingsSubmit);
            prevQuestionBtn.addEventListener('click', showPreviousQuestion);
            nextQuestionBtn.addEventListener('click', handleNextQuestion);
            newExamBtn.addEventListener('click', showSettingsPage);
            returnHomeBtn.addEventListener('click', showHomePage);
            
            // Navigation Functions
            function showPage(pageToShow) {
                // Hide all pages
                homePage.classList.add('hidden');
                settingsPage.classList.add('hidden');
                examPage.classList.add('hidden');
                resultsPage.classList.add('hidden');
                
                // Show requested page
                pageToShow.classList.remove('hidden');
            }
            
            function showHomePage() {
                showPage(homePage);
                // Reset any ongoing tests
                if (timer) {
                    clearInterval(timer);
                }
            }
            
            function showSettingsPage() {
                showPage(settingsPage);
            }
            
            function showExamPage() {
                showPage(examPage);
                startExam();
            }
            
            function showResultsPage() {
                showPage(resultsPage);
                showResults();
            }
            
            // API Functions
            async function loadCategories() {
                try {
                    const response = await fetch('https://opentdb.com/api_category.php');
                    const data = await response.json();
                    
                    // Clear existing options except the default
                    categorySelect.innerHTML = '<option value="">Alle Kategorien</option>';
                    
                    // Add categories
                    data.trivia_categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        categorySelect.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error loading categories:', error);
                    errorMessage.textContent = 'Fehler beim Laden der Kategorien. Bitte versuche es später erneut.';
                    errorMessage.classList.remove('hidden');
                }
            }
            
            async function loadQuestions(settings) {
                // Construct API URL
                let url = `https://opentdb.com/api.php?amount=${settings.amount}&type=multiple`;
                
                if (settings.category) {
                    url += `&category=${settings.category}`;
                }
                
                if (settings.difficulty) {
                    url += `&difficulty=${settings.difficulty}`;
                }
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.response_code === 0) {
                        return data.results;
                    } else {
                        throw new Error('Keine Fragen gefunden. Bitte andere Einstellungen wählen.');
                    }
                } catch (error) {
                    throw error;
                }
            }
            
            // Form Handling
            async function handleSettingsSubmit(event) {
                event.preventDefault();
                
                const settings = {
                    category: categorySelect.value,
                    difficulty: document.getElementById('difficulty').value,
                    amount: parseInt(document.getElementById('amount').value),
                    timePerQuestion: parseInt(document.getElementById('time').value)
                };
                
                // Validate inputs
                if (settings.amount < 1 || settings.amount > 50) {
                    alert('Bitte wähle zwischen 1 und 50 Fragen.');
                    return;
                }
                
                if (settings.timePerQuestion < 10 || settings.timePerQuestion > 300) {
                    alert('Bitte wähle eine Zeit zwischen 10 und 300 Sekunden pro Frage.');
                    return;
                }
                
                // Show loading state
                loadingIndicator.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                
                try {
                    // Load questions
                    questions = await loadQuestions(settings);
                    
                    // Set up exam
                    timePerQuestion = settings.timePerQuestion;
                    currentQuestionIndex = 0;
                    userAnswers = Array(questions.length).fill(null);
                    
                    // Update UI
                    totalQuestionsSpan.textContent = questions.length;
                    
                    // Hide loading and show exam page
                    loadingIndicator.classList.add('hidden');
                    showExamPage();
                } catch (error) {
                    loadingIndicator.classList.add('hidden');
                    errorMessage.textContent = error.message || 'Fehler beim Laden der Fragen. Bitte versuche es später erneut.';
                    errorMessage.classList.remove('hidden');
                }
            }
            
            // Exam Functions
            function startExam() {
                displayQuestion();
                startTimer();
            }
            
            function displayQuestion() {
                const question = questions[currentQuestionIndex];
                
                // Update question number and progress bar
                currentQuestionSpan.textContent = currentQuestionIndex + 1;
                const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
                progressBarFill.style.width = `${progress}%`;
                
                // Update navigation buttons
                prevQuestionBtn.disabled = currentQuestionIndex === 0;
                if (currentQuestionIndex === questions.length - 1) {
                    nextQuestionBtn.textContent = 'Prüfung abschließen';
                } else {
                    nextQuestionBtn.textContent = 'Nächste Frage';
                }
                
                // Update difficulty badge
                const difficultyBadge = document.getElementById('question-difficulty');
                difficultyBadge.textContent = formatDifficulty(question.difficulty);
                difficultyBadge.className = `difficulty-badge difficulty-${question.difficulty}`;
                
                // Set category
                document.getElementById('question-category').textContent = question.category;
                
                // Set question text
                document.getElementById('question-text').innerHTML = decodeHTML(question.question);
                
                // Create answer options
                const answersContainer = document.getElementById('answers-container');
                answersContainer.innerHTML = '';
                
                // Combine correct and incorrect answers
                const allAnswers = [
                    ...question.incorrect_answers,
                    question.correct_answer
                ];
                
                // Shuffle answers
                shuffleArray(allAnswers);
                
                // Create answer elements
                allAnswers.forEach((answer, index) => {
                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'answer-option p-3';
                    answerDiv.dataset.answer = answer;
                    
                    // Check if this answer was previously selected
                    if (userAnswers[currentQuestionIndex] === answer) {
                        answerDiv.classList.add('selected');
                    }
                    
                    answerDiv.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input type="radio" name="answer" id="answer-${index}" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300"
                                    ${userAnswers[currentQuestionIndex] === answer ? 'checked' : ''}>
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="answer-${index}" class="font-medium text-gray-700">${decodeHTML(answer)}</label>
                            </div>
                        </div>
                    `;
                    
                    // Add click event
                    answerDiv.addEventListener('click', () => {
                        // Remove selected class from all options
                        document.querySelectorAll('.answer-option').forEach(option => {
                            option.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked option
                        answerDiv.classList.add('selected');
                        
                        // Check the radio button
                        const radio = answerDiv.querySelector('input[type="radio"]');
                        radio.checked = true;
                        
                        // Save the answer
                        userAnswers[currentQuestionIndex] = answer;
                    });
                    
                    answersContainer.appendChild(answerDiv);
                });
                
                // Reset the timer
                resetTimer();
            }
            
            function showPreviousQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    displayQuestion();
                }
            }
            
            function handleNextQuestion() {
                // Save current answer if selected
                const selectedOption = document.querySelector('.answer-option.selected');
                if (selectedOption) {
                    userAnswers[currentQuestionIndex] = selectedOption.dataset.answer;
                }
                
                if (currentQuestionIndex < questions.length - 1) {
                    // Move to next question
                    currentQuestionIndex++;
                    displayQuestion();
                } else {
                    // End exam
                    finishExam();
                }
            }
            
            function startTimer() {
                // Clear any existing timer
                if (timer) {
                    clearInterval(timer);
                }
                
                // Set initial time
                timeLeft = timePerQuestion;
                updateTimerDisplay();
                
                // Start the timer
                timer = setInterval(() => {
                    timeLeft--;
                    totalTimeUsed++;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        // Time's up for this question
                        if (currentQuestionIndex < questions.length - 1) {
                            // Move to next question
                            currentQuestionIndex++;
                            displayQuestion();
                        } else {
                            // End exam
                            finishExam();
                        }
                    }
                }, 1000);
            }
            
            function resetTimer() {
                // Clear existing timer
                if (timer) {
                    clearInterval(timer);
                }
                
                // Reset and start new timer
                timeLeft = timePerQuestion;
                updateTimerDisplay();
                
                // Start the timer
                timer = setInterval(() => {
                    timeLeft--;
                    totalTimeUsed++;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        // Time's up for this question
                        if (currentQuestionIndex < questions.length - 1) {
                            // Move to next question
                            currentQuestionIndex++;
                            displayQuestion();
                        } else {
                            // End exam
                            finishExam();
                        }
                    }
                }, 1000);
            }
            
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Change color when time is running low
                if (timeLeft <= 10) {
                    timeDisplay.classList.add('text-red-600');
                    timeDisplay.classList.remove('text-indigo-600');
                } else {
                    timeDisplay.classList.add('text-indigo-600');
                    timeDisplay.classList.remove('text-red-600');
                }
            }
            
            function finishExam() {
                // Stop the timer
                if (timer) {
                    clearInterval(timer);
                }
                
                // Show results page
                showResultsPage();
            }
            
            // Results Functions
            function showResults() {
                // Calculate score
                let correctAnswers = 0;
                questions.forEach((question, index) => {
                    if (userAnswers[index] === question.correct_answer) {
                        correctAnswers++;
                    }
                });
                
                // Update score display
                const scoreElement = document.getElementById('total-score');
                scoreElement.textContent = `${correctAnswers}/${questions.length}`;
                
                // Update percentage
                const percentageElement = document.getElementById('score-percentage');
                const percentage = Math.round((correctAnswers / questions.length) * 100);
                percentageElement.textContent = `${percentage}%`;
                
                // Set appropriate color based on score
                if (percentage >= 80) {
                    percentageElement.classList.add('text-green-600');
                    percentageElement.classList.remove('text-indigo-600', 'text-red-600');
                } else if (percentage >= 50) {
                    percentageElement.classList.add('text-indigo-600');
                    percentageElement.classList.remove('text-green-600', 'text-red-600');
                } else {
                    percentageElement.classList.add('text-red-600');
                    percentageElement.classList.remove('text-indigo-600', 'text-green-600');
                }
                
                // Update time used
                const timeElement = document.getElementById('total-time');
                const minutes = Math.floor(totalTimeUsed / 60);
                const seconds = totalTimeUsed % 60;
                timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Create detailed review
                const reviewContainer = document.getElementById('questions-review');
                reviewContainer.innerHTML = '';
                
                questions.forEach((question, index) => {
                    const isCorrect = userAnswers[index] === question.correct_answer;
                    const reviewCard = document.createElement('div');
                    reviewCard.className = `border rounded-lg p-4 ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
                    
                    // Difficulty badge
                    const difficultyHTML = `
                        <span class="difficulty-badge difficulty-${question.difficulty} text-xs">
                            ${formatDifficulty(question.difficulty)}
                        </span>
                    `;
                    
                    // Result badge
                    const resultHTML = `
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${isCorrect ? 'Richtig' : 'Falsch'}
                        </span>
                    `;
                    
                    // Build card content
                    reviewCard.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="font-medium text-gray-900">Frage ${index + 1}</span>
                                ${difficultyHTML}
                            </div>
                            ${resultHTML}
                        </div>
                        <p class="text-gray-800 font-medium mb-3">${decodeHTML(question.question)}</p>
                        <div class="space-y-2">
                            <div class="flex items-start">
                                <div class="mr-2 text-green-600 font-bold">✓</div>
                                <div class="text-green-700">Richtige Antwort: ${decodeHTML(question.correct_answer)}</div>
                            </div>
                            ${!isCorrect ? `
                                <div class="flex items-start">
                                    <div class="mr-2 text-red-600 font-bold">✗</div>
                                    <div class="text-red-700">Deine Antwort: ${userAnswers[index] ? decodeHTML(userAnswers[index]) : 'Keine Antwort'}</div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    reviewContainer.appendChild(reviewCard);
                });
            }
            
            // Utility Functions
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function decodeHTML(html) {
                const txt = document.createElement('textarea');
                txt.innerHTML = html;
                return txt.value;
            }
            
            function formatDifficulty(difficulty) {
                switch (difficulty) {
                    case 'easy': return 'Leicht';
                    case 'medium': return 'Mittel';
                    case 'hard': return 'Schwer';
                    default: return difficulty;
                }
            }
        });
    </script>
</body>
</html>
</antArtifact>

